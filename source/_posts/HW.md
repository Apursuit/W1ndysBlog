---
title: HW
tags:
  - HW
categories:
  - HW
abbrlink: 8c7613a5
date: 2024-04-07 13:21:31
---

# HW

## HW

linux 系统
首先查看一下基础信息
netstat -ano/-a #查看端口情况
uname -a #系统信息
ps -aux ps -ef #进程信息
cat /etc/passwd #用户情况
ls /home/ #用户情况

查看日志文件
/var/log/nginx/ #默认 Nginx 日志目录
/var/log/apache/ #默认 Apache 日志目录
/var/log/apache2/ #默认 Apache 日志目录
/usr/local/tomcat/logs #Tomcat 日志目录

tail -f xxx.log #实时刷新滚动日志文件

通过命令查看可疑文件
find /var/www/html -name _.php -mmin -20 #查看最近 20 分钟修改文件
find ./ -name '_.php' | xargs wc -l | sort -u #寻找行数最短文件
grep -r --include=_.php '[^a-z]eval($\_POST' /var/www/html #查包含关键字的 php 文件
find /var/www/html -type f -name "_.php" | xargs grep "eval(" |more

不死马查杀命令（只是临时解决方案，彻底解决请重启服务器）

<?php system("kill -9 pid;rm -rf .shell.php"); ?>  #pid和不死马名称根据实际情况定

后门用户查杀：
UID 大于 500 的都是非系统账号，500 以下的都为系统保留的账号，使用 userdel -r username 完全删除账户

通过主机安全和态势感知发现告警，这类发现告警的话是可以定位到具体的时间的，根据发生时间来上级排查，定位该时间段内服务器上有做修改的文件，可以快速排查到是否存在 webshell 文件

windows 系统

1. 首先排查 windows 日志查看可疑时间段内的操作，查看 windows 日志方法（通过运行命令。按下“Win+R”键打开运行窗口，输入“eventvwr.msc”后按回车键），需要重点排查的内容是，在被攻击的时间段内的文件打开记录. 自启动运行记录. 软件运行记录，通过排查日志来清理入侵者上传的后门等文件
   [图片]

2. 排查目前的进程，按住 Ctrl+Shift+esc 可以打开任务管理器，需要观察的是占用网络比较大的进程，可以按照网络排序查看是否有占用流量比较大的的进程，右键可以定位到该文件在磁盘中的物理位置，查看可疑文件的创建时间来判断是否为攻击者上传的文件（这个时间也可以修改的，只能作为参考，并不代表创建时间较老就不是攻击者上传的文件）
   [图片]

3. 查看系统自启动项（通过运行命令。按下“Win+R”键打开运行窗口，输入“msconfig.exe”后按回车键）需要查看的是服务这里面是否有可疑的自启动项，这里面显示的是在开机的时候会自动运行的命令，如果被攻击的话可能在这里看到是否有攻击者为了维持权限添加的自启动项，从而定位到木马文件。
   [图片]

4. 查看系统用户是否存在影子用户，打开注册表查看 KEY_LOCAL_MACHINE/SAM/SAM/Domains/Account/Users/下是否存在陌生账户，及时删除。
   影子账户：通过修改注册表内用的 abc`$值和已存在用户abc$`的相同的手段，可以实现 net user 命令看不到用户；用户管理窗口也看不到用户；只可以通过注册表查看到该用户，攻击者可以利用该账号直接登录到系统

## 安全设备

雷池 waf https://waf-ce.chaitin.cn/

报警

绝大部分攻击流量都是 http，web 层面，看流量包研判

其他的应用绝大部分都是密码暴破 mysql，rdp，ssh，mssql，redis 等

常见协议的端口

## 简单的 payload

扫描器的 payload，sql 注入，xss，xxe，ssti，命令注入，代码注入，请求走私，反弹 shell，webshell 上传

## 复杂的 payload

反序列化 payload，编码 payload，webshell 通信

常见的绕过，{IFS}，%00，/\*\*/，0x1212123213

## 溯源

### 网络层面

安全设备的记录，态势感知，日志审计，定位源 ip

定位真实 ip：社工，攻击者工具漏洞，蜜罐

### 主机层面

#### 用户

登录记录，突然多出来的用户，隐藏用户

#### 进程

特权进程，隐藏进程，资源占用比较高的进程

#### 网络连接

本机和其他机器建立的连接，dns 隧道

微步在线 IP 和域名是否是恶意的 https://x.threatbook.com/

#### 常见的持久化手段

webshell，ssh 后门，icmp 隧道，dns 隧道等

## 主要的 Web 漏洞

### Sql 注入

原理：网站数据过滤不严格，过分信赖用户输入的数据, 没有过滤用户输入的恶意数据，无条件的把用户输入的数据当作 SQL 语句执行，因此导致 sql 注入漏洞产生

Sql 注入分类：

1.  以有无闭合字符分类：字符型. 整数型
2.  以数据传输方式分类：post 类型. get 类型
3.  注入方式细分：联合查询注入. 报错型注入. 布尔型盲注. 时间型盲注. 宽字节注入

报错注入常用函数：`UpdateXML() `. `Floor()`. `Extractvalue()`

mysql 默认存在的哪个数据库，注入时经常用到？

> `Information_schema`

时间型盲注特点？常用函数？易受到什么影响？

1.  场景：应用于无数据回显，无报错，布尔型盲注失效后

2.  特点：时间型盲注页面没有明显的回显，只能根据页面刷新时间的长短来去判断构造语句是否正确；

3.  常用函数: sleep 函数 if 条件语句 等

4.  易受网络波动影响

布尔型盲注特点?常用函数？

1.  特点:根据页面正确和错误的两种状态，来判断构造语句是否正确

2.  常用函数：

    1.  length() #用以猜测数据返回字符串的长度
    2.  Sunstr() #截取字符串
    3.  Mid() #取出字符串的一部分值
    4.  Left() #取出字符串左边的几个数据
    5.  Ascii() #返回一个字符的 ascii 码值

sql 手注的一般步骤

1. 判断注入点

2. 判断注入类型

3. 判断注入点提交方式

4. 使用 order by 语句查询数据库有多少字段

5. 使用联合查询来查询 union select

   User（） 当前用户

   Database() 数据库

   Version() 数据库版本

6. 查询数据库中的表. 列和值

## 应急响应问题

### linux 服务器被上传 webshell，如何进行应急

1.  在网站的根目录下用下河马或者 d 盾扫下看看，看看能不能扫出 webshell

2.  查看网站的 web 日志，使用 weblshell 会在网站的 web 日志中留下 Webshell 页面的访问数据和数据提交记录，主要特征是少量 ip 对其发起访问，总的访问次数少，该页面属于孤立页面

3.  看下相关设备的告警流量，看下 web shell 的名字和路径，然后在服务器上使用 find 命令进行查找。并删除

### hw 期间的应急响应

1.  一般先封堵攻击源 IP，事件处置组人员根据攻击事件通报信息或报告，封禁攻击源 IP
